<script type="module">
  import { loadParticipants, addParticipant, editParticipant, sortParticipants } from './database.js';

  // Renderiza a lista inicial
  const participants = sortParticipants();
  renderParticipants(participants);

  function renderParticipants(participants) {
    const list = document.getElementById("list");
    list.innerHTML = "";
    participants.forEach((participant, index) => {
      const listItem = document.createElement("li");
      listItem.innerHTML = `
        <span id="participant-${index}" onclick="startEdit(${index})">${index + 1}. ${participant.name}</span>
        <span class="${participant.paid ? 'paid' : 'not-paid'}">
          ${participant.paid ? "âœ“" : "X"}
        </span>
      `;
      list.appendChild(listItem);
    });
  }

  function startEdit(index) {
    const participants = loadParticipants();
    const participant = participants[index];
    const newName = prompt("Novo nome:", participant.name);
    const newStatus = confirm("Marcar como pago?");
    const password = prompt("Digite a senha para salvar:");
    if (password === "0000") {
      editParticipant(index, newName, newStatus);
      renderParticipants(sortParticipants());
    } else {
      alert("Senha incorreta!");
    }
  }

  function startAdd() {
    const name = prompt("Digite o nome:");
    if (!name) return;
    const password = prompt("Digite a senha para adicionar:");
    if (password === "0000") {
      if (addParticipant(name)) {
        renderParticipants(sortParticipants());
      }
    } else {
      alert("Senha incorreta!");
    }
  }
</script>
